<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>[ANSWER] ì•ˆì •ì  ì´ˆê¸°í™” + ë°ì´í„° ë³´í˜¸ + ë¡œê·¸ ì‹ ë¢°ì„± + íŒŒì‹± ìµœì í™”</title>

  <!-- ì™¸ë¶€ SDK: asyncë¡œ ë³‘ë ¬ ë‹¤ìš´ë¡œë“œ, íŒŒì‹± ì°¨ë‹¨ ì œê±° -->
  <script src="data:text/javascript;charset=utf-8,
    (function(){
      setTimeout(function(){
        console.log('[ANSWER SDK] async ë¡œë”©(íŒŒì‹± ì°¨ë‹¨ ì—†ìŒ) + ë¹„ë™ê¸° ì´ˆê¸°í™” ì™„ë£Œ');
      }, 0);
    })();
  " async></script>

  <style>
    :root { --pad: 24px; --bg: #0b1220; --fg: #e5e7eb; --muted:#94a3b8; }
    @media (prefers-color-scheme: light) {
      :root { --bg: #ffffff; --fg:#0b1220; --muted:#475569; }
    }
    body { font-family: system-ui, sans-serif; margin: var(--pad); background: var(--bg); color: var(--fg); }
    header { margin-bottom: 12px; }
    #username .badge { background:#ef4444; color:#fff; padding:2px 6px; margin-left:8px; border-radius:12px; font-size:12px; }
    #card { background: color-mix(in srgb, var(--fg), transparent 85%); margin-top: 10px; display:flex; align-items:center; justify-content:center; transition: height .2s ease; }
    textarea { width: 100%; height: 160px; margin-top: 16px; color: inherit; background: color-mix(in srgb, var(--fg), transparent 92%); border: 1px solid color-mix(in srgb, var(--fg), transparent 70%); }
    .hint { color: var(--muted); font-size: 14px; margin-top: 8px; }
  </style>

  <script>
    // --- ìœ í‹¸: ì´ˆì•ˆ ìë™ ì €ì¥(ê°„ë‹¨ throttle) ---
    function throttle(fn, wait){
      let t = 0, lastArgs = null;
      return function(...args){
        const now = Date.now();
        lastArgs = args;
        if(now - t >= wait){
          t = now;
          fn.apply(this, args);
        } else {
          clearTimeout(throttle._tid);
          throttle._tid = setTimeout(() => {
            t = Date.now();
            fn.apply(this, lastArgs);
          }, wait - (now - t));
        }
      }
    }

    // 1) DOMContentLoaded â†’ ì¦‰ì‹œ ë°˜ì‘í•´ì•¼ í•˜ëŠ” DOM ì‘ì—…
    document.addEventListener("DOMContentLoaded", () => {
      console.log("ğŸš€ DOMContentLoaded - DOM ì¤€ë¹„ ì™„ë£Œ");

      // ì‚¬ìš©ì ì´ë¦„/ì•Œë¦¼ ë°°ì§€ í‘œì‹œ (ì¦‰ì‹œ)
      const usernameEl = document.getElementById("username");
      usernameEl.textContent = "í™ê¸¸ë™ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!";
      const badge = document.createElement("span");
      badge.className = "badge";
      badge.textContent = "3";
      usernameEl.appendChild(badge);

      // draft ë³µì›
      const cached = localStorage.getItem("draft");
      if (cached) document.getElementById("report").value = cached;

      // ì…ë ¥ ì¤‘ì—” ìë™ ì €ì¥(throttle)
      const saver = throttle((val) => localStorage.setItem("draft", val), 500);
      document.getElementById("report").addEventListener("input", e => saver(e.target.value));
    });

    // 2) load â†’ ì´ë¯¸ì§€(ë¦¬ì†ŒìŠ¤) ì˜ì¡´ ë ˆì´ì•„ì›ƒ ê³„ì‚°
    window.addEventListener("load", () => {
      console.log("ğŸŒ load - ëª¨ë“  ë¦¬ì†ŒìŠ¤ ë¡œë”© ì™„ë£Œ");
      const banner = document.getElementById("banner");
      const card = document.getElementById("card");

      // ë°°ë„ˆ ì‹¤ì œ ë†’ì´ ê¸°ë°˜ìœ¼ë¡œ ì¹´ë“œ ë†’ì´ ë°˜ì˜
      const h = banner.naturalHeight;               // ì‹¤ì œ ì´ë¯¸ì§€ ë†’ì´
      card.style.height = Math.max(h, 140) + "px";  // ìµœì†Œ ë†’ì´ ê°€ë“œ
      console.log("ì¹´ë“œ ë†’ì´(ì •í™•íˆ ë°˜ì˜):", card.style.height);
    });

    // 3) beforeunload â†’ ë°ì´í„° ë³´í˜¸(ê²½ê³  + draft ë³´ì¡´)
    window.addEventListener("beforeunload", (event) => {
      const text = document.getElementById("report").value;
      if (text.trim() !== "") {
        localStorage.setItem("draft", text); // ì´ˆì•ˆ ì €ì¥
        event.preventDefault();
        event.returnValue = "";              // ë¸Œë¼ìš°ì € ê¸°ë³¸ ê²½ê³ 
      }
    });

    // 4) unload â†’ ì„¸ì…˜ ì¢…ë£Œ ë¡œê·¸(ì‹ ë¢°ì„± â†‘)
    window.addEventListener("unload", () => {
      const payload = JSON.stringify({
        sessionId: "sess-" + Math.floor(performance.timeOrigin),
        end: Date.now(),
        page: location.pathname,
        timeSpentMs: Math.round(performance.now())
      });
      // sendBeacon: ì¢…ë£Œ ì§ì „ì—ë„ ë¹„ë™ê¸° ì „ì†¡ ì‹œë„(ì™„ì „ ë³´ì¥ì€ ì•„ë‹˜)
      navigator.sendBeacon("/analytics/exit", payload);
    });
  </script>
</head>
<body>
  <header>
    <h1 id="username">ë¡œë”© ì¤‘...</h1>
    <p class="hint">â€» DevTools â†’ Performanceì—ì„œ Timings(ğŸš€DOMContentLoaded / ğŸŒload) ë§ˆì»¤ë¥¼ ìº¡ì²˜í•´ ë¹„êµí•˜ì„¸ìš”.</p>
  </header>

  <!-- ìœ íš¨í•œ ì´ë¯¸ì§€: ë°ì´í„° URI(SVG, 800Ã—200) -->
  <img id="banner"
       alt="ë°°ë„ˆ ì´ë¯¸ì§€"
       src="data:image/svg+xml;charset=UTF-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='200'%3E%3Cdefs/%3E%3Crect width='100%25' height='100%25' fill='%23dbeafe'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-size='32' fill='%231d4ed8'%3EAnalytics%20Banner%20800x200%3C/text%3E%3C/svg%3E" />

  <section id="card">
    <p>ì¹´ë“œ ì½˜í…ì¸ (ë°°ë„ˆ ë†’ì´ì— ë§ì¶° ì„¸ë¡œ í¬ê¸°ê°€ ì§€ì •ë©ë‹ˆë‹¤)</p>
  </section>

  <textarea id="report" placeholder="ì—¬ê¸°ì— ë³´ê³ ì„œë¥¼ ì‘ì„±í•˜ì„¸ìš”(ì‘ì„± ì¤‘ ì´íƒˆ ì‹œì—ë„ draftê°€ ë³´ì¡´ë©ë‹ˆë‹¤)"></textarea>
</body>
</html>
